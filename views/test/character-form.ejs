<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è¿½è·¡ãƒ†ã‚¹ãƒˆ - Identity V Tournament</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <header>
        <nav class="navbar">
            <div class="nav-brand">
                <h1><a href="/">Identity V Tournament</a></h1>
            </div>
            <div class="nav-links">
                <a href="/test/character-form" class="active">ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ãƒ†ã‚¹ãƒˆ</a>
                <a href="/test/results">çµæœè¡¨ç¤º</a>
            </div>
        </nav>
    </header>

    <main class="container">
        <div class="page-header">
            <h2>ğŸ§ª ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è¿½è·¡æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ</h2>
            <p>ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‚’é–¢é€£ä»˜ã‘ã‚‹æ©Ÿèƒ½ã®ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸ã§ã™</p>
        </div>

        <div class="match-results-content">
            <!-- Add Match Result Form -->
            <div class="add-result-section card">
                <h3>â• æ–°ã—ã„è©¦åˆçµæœã‚’è¿½åŠ ï¼ˆã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ä»˜ãï¼‰</h3>
                <form action="/test/match-results" method="POST" class="match-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="tournamentId">å¤§ä¼šé¸æŠ</label>
                            <select id="tournamentId" name="tournamentId" required>
                                <option value="">å¤§ä¼šã‚’é¸æŠã—ã¦ãã ã•ã„</option>
                                <% tournaments.forEach(tournament => { %>
                                    <option value="<%= tournament.id %>"><%= tournament.title %></option>
                                <% }); %>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="seriesId">ã‚·ãƒªãƒ¼ã‚ºé¸æŠï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰</label>
                            <select id="seriesId" name="seriesId">
                                <option value="">å€‹åˆ¥è©¦åˆï¼ˆã‚·ãƒªãƒ¼ã‚ºãªã—ï¼‰</option>
                                <% activeSeries.forEach(series => { %>
                                    <option value="<%= series.id %>">
                                        <%= series.seriesTitle %> (<%= series.seriesType %>) - 
                                        <%= series.team1Name %> vs <%= series.team2Name %>
                                    </option>
                                <% }); %>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="matchTitle">è©¦åˆå</label>
                            <input type="text" id="matchTitle" name="matchTitle" required 
                                   placeholder="ä¾‹: ãƒ†ã‚¹ãƒˆè©¦åˆ1">
                        </div>
                        <div class="form-group">
                            <label for="hunterTeam">ãƒãƒ³ã‚¿ãƒ¼ã®ãƒãƒ¼ãƒ ï¼ˆã‚·ãƒªãƒ¼ã‚ºã®å ´åˆï¼‰</label>
                            <select id="hunterTeam" name="hunterTeam">
                                <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                                <option value="team1">ãƒãƒ¼ãƒ 1</option>
                                <option value="team2">ãƒãƒ¼ãƒ 2</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="hunterPlayer">ãƒãƒ³ã‚¿ãƒ¼ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼</label>
                            <input type="text" id="hunterPlayer" name="hunterPlayer" required 
                                   placeholder="ãƒãƒ³ã‚¿ãƒ¼ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼å">
                        </div>
                        <div class="form-group">
                            <label for="hunterCharacter">ãƒãƒ³ã‚¿ãƒ¼ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ï¼ˆä»Šå¾Œå®Ÿè£…äºˆå®šï¼‰</label>
                            <input type="text" id="hunterCharacter" name="hunterCharacter" 
                                   placeholder="ä»Šå¾Œå®Ÿè£…äºˆå®š" disabled>
                        </div>
                    </div>

                    <!-- Survivor Players Section -->
                    <div class="survivors-section">
                        <h4>ã‚µãƒã‚¤ãƒãƒ¼ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼</h4>
                        <div class="survivor-players">
                            <% for (let i = 1; i <= 4; i++) { %>
                                <div class="survivor-row">
                                    <div class="form-group survivor-name">
                                        <label for="survivorPlayer<%= i %>">ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼<%= i %></label>
                                        <input type="text" id="survivorPlayer<%= i %>" name="survivorPlayer<%= i %>" 
                                               placeholder="ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼å">
                                    </div>
                                    <div class="form-group survivor-character">
                                        <label for="survivorCharacter<%= i %>">ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼</label>
                                        <select id="survivorCharacter<%= i %>" name="survivorCharacter<%= i %>">
                                            <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                                            <% survivorCharacters.forEach(character => { %>
                                                <option value="<%= character.id %>"><%= character.name %></option>
                                            <% }); %>
                                        </select>
                                    </div>
                                </div>
                            <% } %>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="eliminatedCount">åŠã‚Šæ•°</label>
                            <select id="eliminatedCount" name="eliminatedCount" required>
                                <option value="0">0äºº</option>
                                <option value="1">1äºº</option>
                                <option value="2">2äºº</option>
                                <option value="3">3äºº</option>
                                <option value="4">4äºº</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="escapedCount">é€ƒã’æ•°</label>
                            <select id="escapedCount" name="escapedCount" required>
                                <option value="0">0äºº</option>
                                <option value="1">1äºº</option>
                                <option value="2">2äºº</option>
                                <option value="3">3äºº</option>
                                <option value="4">4äºº</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="notes">ãƒ¡ãƒ¢ãƒ»å‚™è€ƒ</label>
                        <textarea id="notes" name="notes" rows="3" 
                                  placeholder="è©¦åˆã«é–¢ã™ã‚‹è¿½åŠ æƒ…å ±ãŒã‚ã‚Œã°è¨˜å…¥ã—ã¦ãã ã•ã„"></textarea>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">ğŸ’¾ çµæœã‚’ä¿å­˜</button>
                        <button type="button" class="btn btn-secondary" onclick="calculatePoints()">ğŸ“Š ãƒã‚¤ãƒ³ãƒˆè¨ˆç®—ç¢ºèª</button>
                    </div>
                </form>
            </div>
        </div>
    </main>

    <style>
        .match-results-content {
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }

        .add-result-section {
            padding: 2rem;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .survivors-section {
            margin: 1.5rem 0;
            padding: 1rem;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.05);
        }

        .survivors-section h4 {
            margin: 0 0 1rem 0;
            color: var(--primary-color);
            font-size: 1.1rem;
        }

        .survivor-players {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .survivor-row {
            display: grid;
            grid-template-columns: 2fr 3fr;
            gap: 1rem;
            align-items: end;
        }

        .survivor-name input,
        .survivor-character select {
            width: 100%;
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .survivor-row {
                grid-template-columns: 1fr;
            }
        }
    </style>

    <script>
        function calculatePoints() {
            const eliminated = parseInt(document.getElementById('eliminatedCount').value) || 0;
            const escaped = parseInt(document.getElementById('escapedCount').value) || 0;
            
            if (eliminated + escaped !== 4) {
                alert('åŠã‚Šæ•°ã¨é€ƒã’æ•°ã®åˆè¨ˆãŒ4ã«ãªã‚‹ã‚ˆã†ã«ã—ã¦ãã ã•ã„ã€‚');
                return;
            }
            
            let hunterPoints = eliminated;
            let survivorPoints = escaped;
            
            alert(`ãƒã‚¤ãƒ³ãƒˆè¨ˆç®—çµæœ:\nãƒãƒ³ã‚¿ãƒ¼: ${hunterPoints}ãƒã‚¤ãƒ³ãƒˆ\nã‚µãƒã‚¤ãƒãƒ¼: ${survivorPoints}ãƒã‚¤ãƒ³ãƒˆ`);
        }
        
        // Auto-calculate escaped count when eliminated count changes
        document.getElementById('eliminatedCount').addEventListener('change', function() {
            const eliminated = parseInt(this.value) || 0;
            const escaped = 4 - eliminated;
            document.getElementById('escapedCount').value = escaped;
        });
        
        // Handle form submission
        document.querySelector('.match-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            
            try {
                const response = await fetch('/test/match-results', {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert('âœ… è©¦åˆçµæœãŒä¿å­˜ã•ã‚Œã¾ã—ãŸï¼\n\nçµæœè¡¨ç¤ºãƒšãƒ¼ã‚¸ã§ç¢ºèªã§ãã¾ã™ã€‚');
                    // Reset form
                    this.reset();
                } else {
                    alert('âŒ ã‚¨ãƒ©ãƒ¼: ' + result.error);
                }
            } catch (error) {
                alert('âŒ ä¿å­˜ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error.message);
            }
        });
    </script>
</body>
</html>