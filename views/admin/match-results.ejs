<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è©¦åˆçµæœç®¡ç† - Identity V Tournament</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <header>
        <nav class="navbar">
            <div class="nav-brand">
                <h1><a href="/">Identity V Tournament</a></h1>
            </div>
            <div class="nav-links">
                <a href="/tournaments">å¤§ä¼šä¸€è¦§</a>
                <a href="/admin" class="active">ç®¡ç†ç”»é¢</a>
                <a href="/auth/logout">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</a>
            </div>
        </nav>
    </header>

    <main class="container">
        <div class="page-header">
            <h2>ğŸ† è©¦åˆçµæœç®¡ç†</h2>
            <p>å¤§ä¼šã®è©¦åˆçµæœã‚’è¨˜éŒ²ãƒ»ç®¡ç†ã—ã¾ã™</p>
        </div>

        <div class="match-results-content">
            <!-- Add Match Result Form -->
            <div class="add-result-section card">
                <h3>â• æ–°ã—ã„è©¦åˆçµæœã‚’è¿½åŠ </h3>
                <form action="/admin/match-results" method="POST" class="match-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="tournamentId">å¤§ä¼šé¸æŠ</label>
                            <select id="tournamentId" name="tournamentId" required>
                                <option value="">å¤§ä¼šã‚’é¸æŠã—ã¦ãã ã•ã„</option>
                                <% tournaments.forEach(tournament => { %>
                                    <option value="<%= tournament.id %>"><%= tournament.title %></option>
                                <% }); %>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="matchTitle">è©¦åˆå</label>
                            <input type="text" id="matchTitle" name="matchTitle" required 
                                   placeholder="ä¾‹: æº–æ±ºå‹ç¬¬1æˆ¦">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="hunterPlayer">ãƒãƒ³ã‚¿ãƒ¼ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼</label>
                            <input type="text" id="hunterPlayer" name="hunterPlayer" required 
                                   placeholder="ãƒãƒ³ã‚¿ãƒ¼ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼å">
                        </div>
                        <div class="form-group">
                            <label for="survivorPlayers">ã‚µãƒã‚¤ãƒãƒ¼ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼ˆã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šï¼‰</label>
                            <input type="text" id="survivorPlayers" name="survivorPlayers" required 
                                   placeholder="ä¾‹: ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼1, ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼2, ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼3, ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼4">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="eliminatedCount">åŠã‚Šæ•°</label>
                            <select id="eliminatedCount" name="eliminatedCount" required>
                                <option value="0">0äºº</option>
                                <option value="1">1äºº</option>
                                <option value="2">2äºº</option>
                                <option value="3">3äºº</option>
                                <option value="4">4äºº</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="escapedCount">é€ƒã’æ•°</label>
                            <select id="escapedCount" name="escapedCount" required>
                                <option value="0">0äºº</option>
                                <option value="1">1äºº</option>
                                <option value="2">2äºº</option>
                                <option value="3">3äºº</option>
                                <option value="4">4äºº</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="notes">ãƒ¡ãƒ¢ãƒ»å‚™è€ƒ</label>
                        <textarea id="notes" name="notes" rows="3" 
                                  placeholder="è©¦åˆã«é–¢ã™ã‚‹è¿½åŠ æƒ…å ±ãŒã‚ã‚Œã°è¨˜å…¥ã—ã¦ãã ã•ã„"></textarea>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">ğŸ’¾ çµæœã‚’ä¿å­˜</button>
                        <button type="button" class="btn btn-secondary" onclick="calculatePoints()">ğŸ“Š ãƒã‚¤ãƒ³ãƒˆè¨ˆç®—ç¢ºèª</button>
                    </div>
                </form>
            </div>

            <!-- Results List -->
            <div class="results-list-section card">
                <h3>ğŸ“‹ è©¦åˆçµæœä¸€è¦§</h3>
                <% if (results.length === 0) { %>
                    <div class="no-results">
                        <p>ã¾ã è©¦åˆçµæœãŒè¨˜éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚</p>
                    </div>
                <% } else { %>
                    <div class="results-table">
                        <table>
                            <thead>
                                <tr>
                                    <th>è©¦åˆå</th>
                                    <th>ãƒãƒ³ã‚¿ãƒ¼</th>
                                    <th>çµæœ</th>
                                    <th>ãƒã‚¤ãƒ³ãƒˆ</th>
                                    <th>æ—¥æ™‚</th>
                                    <th>æ“ä½œ</th>
                                </tr>
                            </thead>
                            <tbody>
                                <% results.forEach(result => { %>
                                    <tr>
                                        <td>
                                            <strong><%= result.matchTitle %></strong>
                                            <% if (result.bonusApplied) { %>
                                                <span class="bonus-badge">ãƒœãƒ¼ãƒŠã‚¹</span>
                                            <% } %>
                                        </td>
                                        <td><%= result.hunterPlayer %></td>
                                        <td>
                                            <span class="result-score">
                                                <%= result.eliminatedCount %>åŠã‚Š : <%= result.escapedCount %>é€ƒã’
                                            </span>
                                        </td>
                                        <td>
                                            <span class="points hunter-points"><%= result.hunterPoints %></span>
                                            :
                                            <span class="points survivor-points"><%= result.survivorPoints %></span>
                                        </td>
                                        <td>
                                            <%= result.createdAt?.toDate ? result.createdAt.toDate().toLocaleDateString('ja-JP') : 'ä¸æ˜' %>
                                        </td>
                                        <td>
                                            <button class="btn btn-small btn-info" onclick="viewDetails('<%= result.id %>')">è©³ç´°</button>
                                        </td>
                                    </tr>
                                <% }); %>
                            </tbody>
                        </table>
                    </div>
                <% } %>
            </div>
        </div>

        <% if (typeof query !== 'undefined' && query.success) { %>
            <div class="success-message">
                âœ… è©¦åˆçµæœãŒæ­£å¸¸ã«ä¿å­˜ã•ã‚Œã¾ã—ãŸï¼
            </div>
        <% } %>
    </main>

    <style>
        .match-results-content {
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }

        .add-result-section,
        .results-list-section {
            padding: 2rem;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .results-table {
            overflow-x: auto;
        }

        .results-table table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }

        .results-table th,
        .results-table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        .results-table th {
            background: rgba(255, 255, 255, 0.1);
            font-weight: 600;
            color: var(--primary-color);
        }

        .result-score {
            font-weight: 600;
            color: var(--accent-color);
        }

        .points {
            display: inline-block;
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            font-weight: 700;
            font-size: 0.9rem;
        }

        .hunter-points {
            background: var(--error-color);
            color: white;
        }

        .survivor-points {
            background: var(--primary-color);
            color: white;
        }

        .bonus-badge {
            display: inline-block;
            padding: 0.2rem 0.5rem;
            background: var(--warning-color);
            color: var(--background-dark);
            font-size: 0.7rem;
            font-weight: 600;
            border-radius: 4px;
            margin-left: 0.5rem;
        }

        .no-results {
            text-align: center;
            padding: 2rem;
            color: var(--text-secondary);
        }

        .btn-small {
            padding: 0.4rem 0.8rem;
            font-size: 0.8rem;
        }

        .btn-info {
            background: var(--secondary-color);
            color: white;
        }

        .btn-info:hover {
            background: var(--secondary-dark);
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
        }
    </style>

    <script>
        function calculatePoints() {
            const eliminated = parseInt(document.getElementById('eliminatedCount').value) || 0;
            const escaped = parseInt(document.getElementById('escapedCount').value) || 0;
            
            if (eliminated + escaped !== 4) {
                alert('åŠã‚Šæ•°ã¨é€ƒã’æ•°ã®åˆè¨ˆãŒ4ã«ãªã‚‹ã‚ˆã†ã«ã—ã¦ãã ã•ã„ã€‚');
                return;
            }
            
            let hunterPoints = eliminated;
            let survivorPoints = escaped;
            let bonusMessage = '';
            
            // Check if bonus scoring would apply (this is a client-side approximation)
            if (eliminated === 4) {
                bonusMessage = '\n\nâš ï¸ 4åŠã‚Šã®å ´åˆã€ãƒœãƒ¼ãƒŠã‚¹ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°ãŒæœ‰åŠ¹ã ã¨ãƒãƒ³ã‚¿ãƒ¼ãƒã‚¤ãƒ³ãƒˆãŒ5ãƒã‚¤ãƒ³ãƒˆã«ãªã‚Šã¾ã™ã€‚';
            }
            
            alert(`ãƒã‚¤ãƒ³ãƒˆè¨ˆç®—çµæœ:\nãƒãƒ³ã‚¿ãƒ¼: ${hunterPoints}ãƒã‚¤ãƒ³ãƒˆ\nã‚µãƒã‚¤ãƒãƒ¼: ${survivorPoints}ãƒã‚¤ãƒ³ãƒˆ${bonusMessage}`);
        }
        
        function viewDetails(resultId) {
            // This would open a modal or navigate to a detail page
            alert('è©³ç´°è¡¨ç¤ºæ©Ÿèƒ½ã¯ä»Šå¾Œå®Ÿè£…äºˆå®šã§ã™ã€‚ID: ' + resultId);
        }
        
        // Auto-calculate escaped count when eliminated count changes
        document.getElementById('eliminatedCount').addEventListener('change', function() {
            const eliminated = parseInt(this.value) || 0;
            const escaped = 4 - eliminated;
            document.getElementById('escapedCount').value = escaped;
        });
    </script>
</body>
</html>