<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ë©¶ÂêàÁµêÊûúÁÆ°ÁêÜ - Identity V Match</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <header>
        <nav class="navbar">
            <div class="nav-brand">
                <h1><a href="/">Identity V Match</a></h1>
            </div>
            <div class="nav-links">
                <a href="/tournaments">Â§ß‰ºö‰∏ÄË¶ß</a>
                <a href="/admin" class="active">ÁÆ°ÁêÜÁîªÈù¢</a>
                <a href="/auth/logout">„É≠„Ç∞„Ç¢„Ç¶„Éà</a>
            </div>
        </nav>
    </header>

    <main class="container">
        <div class="page-header">
            <h2>üèÜ Ë©¶ÂêàÁµêÊûúÁÆ°ÁêÜ</h2>
            <p>Â§ß‰ºö„ÅÆË©¶ÂêàÁµêÊûú„ÇíË®òÈå≤„ÉªÁÆ°ÁêÜ„Åó„Åæ„Åô</p>
        </div>

        <div class="match-results-content">
            <!-- Add Match Result Form -->
            <div class="add-result-section card">
                <h3>‚ûï Êñ∞„Åó„ÅÑË©¶ÂêàÁµêÊûú„ÇíËøΩÂä†</h3>
                <form action="/admin/match-results" method="POST" class="match-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="tournamentId">Â§ß‰ºöÈÅ∏Êäû</label>
                            <select id="tournamentId" name="tournamentId" required>
                                <option value="">Â§ß‰ºö„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</option>
                                <% tournaments.forEach(tournament => { %>
                                    <option value="<%= tournament.id %>"><%= tournament.title %></option>
                                <% }); %>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="seriesId">„Ç∑„É™„Éº„Ç∫ÈÅ∏ÊäûÔºà„Ç™„Éó„Ç∑„Éß„É≥Ôºâ</label>
                            <select id="seriesId" name="seriesId">
                                <option value="">ÂÄãÂà•Ë©¶ÂêàÔºà„Ç∑„É™„Éº„Ç∫„Å™„ÅóÔºâ</option>
                                <% activeSeries.forEach(series => { %>
                                    <option value="<%= series.id %>">
                                        <%= series.seriesTitle %> (<%= series.seriesType %>) - 
                                        <%= series.team1Name %> vs <%= series.team2Name %>
                                    </option>
                                <% }); %>
                            </select>
                        </div>
                    </div>

                    <!-- Team Selection Section -->
                    <div class="form-row" id="teamSelectionRow" style="display: none;">
                        <div class="form-group">
                            <label for="hunterTeamSelect">„Éè„É≥„Çø„Éº„ÉÅ„Éº„É†ÈÅ∏Êäû</label>
                            <select id="hunterTeamSelect" name="hunterTeamSelect">
                                <option value="">„ÉÅ„Éº„É†„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="survivorTeamSelect">„Çµ„Éê„Ç§„Éê„Éº„ÉÅ„Éº„É†ÈÅ∏Êäû</label>
                            <select id="survivorTeamSelect" name="survivorTeamSelect">
                                <option value="">„ÉÅ„Éº„É†„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="matchTitle">Ë©¶ÂêàÂêç</label>
                            <input type="text" id="matchTitle" name="matchTitle" required 
                                   placeholder="‰æã: Ê∫ñÊ±∫ÂãùÁ¨¨1Êà¶ „Åæ„Åü„ÅØ „Ç≤„Éº„É†1">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="hunterPlayer">„Éè„É≥„Çø„Éº„Éó„É¨„Ç§„É§„Éº</label>
                            <input type="text" id="hunterPlayer" name="hunterPlayer" required 
                                   placeholder="„Éè„É≥„Çø„Éº„ÅÆ„Éó„É¨„Ç§„É§„ÉºÂêç">
                        </div>
                        <div class="form-group">
                            <label for="hunterCharacter">„Éè„É≥„Çø„Éº„Ç≠„É£„É©„ÇØ„Çø„Éº</label>
                            <select id="hunterCharacter" name="hunterCharacter">
                                <option value="">„Ç≠„É£„É©„ÇØ„Çø„Éº„ÇíÈÅ∏ÊäûÔºà„Ç™„Éó„Ç∑„Éß„É≥Ôºâ</option>
                                <% hunterCharacters.forEach(character => { %>
                                    <option value="<%= character.id %>"><%= character.name %></option>
                                <% }); %>
                            </select>
                        </div>
                    </div>

                    <!-- Survivor Players Section -->
                    <div class="survivors-section">
                        <h4>„Çµ„Éê„Ç§„Éê„Éº„Éó„É¨„Ç§„É§„Éº</h4>
                        <div class="survivor-players">
                            <% for (let i = 1; i <= 4; i++) { %>
                                <div class="survivor-row">
                                    <div class="form-group survivor-name">
                                        <label for="survivorPlayer<%= i %>">„Éó„É¨„Ç§„É§„Éº<%= i %></label>
                                        <input type="text" id="survivorPlayer<%= i %>" name="survivorPlayer<%= i %>" 
                                               placeholder="„Éó„É¨„Ç§„É§„ÉºÂêç">
                                    </div>
                                    <div class="form-group survivor-character">
                                        <label for="survivorCharacter<%= i %>">„Ç≠„É£„É©„ÇØ„Çø„Éº</label>
                                        <select id="survivorCharacter<%= i %>" name="survivorCharacter<%= i %>">
                                            <option value="">ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</option>
                                            <% survivorCharacters.forEach(character => { %>
                                                <option value="<%= character.id %>"><%= character.name %></option>
                                            <% }); %>
                                        </select>
                                    </div>
                                </div>
                            <% } %>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="eliminatedCount">Âêä„ÇäÊï∞</label>
                            <select id="eliminatedCount" name="eliminatedCount" required>
                                <option value="0">0‰∫∫</option>
                                <option value="1">1‰∫∫</option>
                                <option value="2">2‰∫∫</option>
                                <option value="3">3‰∫∫</option>
                                <option value="4">4‰∫∫</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="escapedCount">ÈÄÉ„ÅíÊï∞</label>
                            <select id="escapedCount" name="escapedCount" required>
                                <option value="0">0‰∫∫</option>
                                <option value="1">1‰∫∫</option>
                                <option value="2">2‰∫∫</option>
                                <option value="3">3‰∫∫</option>
                                <option value="4">4‰∫∫</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="notes">„É°„É¢„ÉªÂÇôËÄÉ</label>
                        <textarea id="notes" name="notes" rows="3" 
                                  placeholder="Ë©¶Âêà„Å´Èñ¢„Åô„ÇãËøΩÂä†ÊÉÖÂ†±„Åå„ÅÇ„Çå„Å∞Ë®òÂÖ•„Åó„Å¶„Åè„Å†„Åï„ÅÑ"></textarea>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">üíæ ÁµêÊûú„Çí‰øùÂ≠ò</button>
                        <button type="button" class="btn btn-secondary" onclick="calculatePoints()">üìä „Éù„Ç§„É≥„ÉàË®àÁÆóÁ¢∫Ë™ç</button>
                    </div>
                </form>
            </div>

            <!-- Results List -->
            <div class="results-list-section card">
                <h3>üìã Ë©¶ÂêàÁµêÊûú‰∏ÄË¶ß</h3>
                <% if (results.length === 0) { %>
                    <div class="no-results">
                        <p>„Åæ„Å†Ë©¶ÂêàÁµêÊûú„ÅåË®òÈå≤„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇ</p>
                    </div>
                <% } else { %>
                    <div class="results-table">
                        <table>
                            <thead>
                                <tr>
                                    <th>Ë©¶ÂêàÂêç</th>
                                    <th>„Ç∑„É™„Éº„Ç∫</th>
                                    <th>„Éè„É≥„Çø„Éº</th>
                                    <th>„Çµ„Éê„Ç§„Éê„Éº</th>
                                    <th>ÁµêÊûú</th>
                                    <th>„Éù„Ç§„É≥„Éà</th>
                                    <th>Êó•ÊôÇ</th>
                                    <th>Êìç‰Ωú</th>
                                </tr>
                            </thead>
                            <tbody>
                                <% results.forEach(result => { %>
                                    <tr>
                                        <td>
                                            <strong><%= result.matchTitle %></strong>
                                            <% if (result.bonusApplied) { %>
                                                <span class="bonus-badge">„Éú„Éº„Éä„Çπ</span>
                                            <% } %>
                                            <% if (result.gameNumber) { %>
                                                <div class="game-info">„Ç≤„Éº„É† <%= result.gameNumber %></div>
                                            <% } %>
                                        </td>
                                        <td>
                                            <% if (result.seriesId) { %>
                                                <span class="series-link">
                                                    <a href="/admin/series/<%= result.seriesId %>">„Ç∑„É™„Éº„Ç∫Ë©≥Á¥∞</a>
                                                </span>
                                            <% } else { %>
                                                <span class="no-series">ÂÄãÂà•Ë©¶Âêà</span>
                                            <% } %>
                                        </td>
                                        <td>
                                            <div class="player-info">
                                                <%= result.hunterPlayer %>
                                                <% if (result.hunterCharacter) { %>
                                                    <div class="character-info">(<%= getCharacterName(result.hunterCharacter, 'hunter') %>)</div>
                                                <% } %>
                                            </div>
                                            <% if (result.hunterTeam) { %>
                                                <div class="team-info">(<%= result.hunterTeam === 'team1' ? '„ÉÅ„Éº„É†1' : '„ÉÅ„Éº„É†2' %>)</div>
                                            <% } %>
                                        </td>
                                        <td>
                                            <div class="survivors-list">
                                                <% if (Array.isArray(result.survivorPlayers)) { %>
                                                    <% result.survivorPlayers.forEach(player => { %>
                                                        <div class="survivor-info">
                                                            <span class="player-name"><%= typeof player === 'object' ? player.name : player %></span>
                                                            <% if (typeof player === 'object' && player.character) { %>
                                                                <span class="character-badge">(<%= getCharacterName(player.character) %>)</span>
                                                            <% } %>
                                                        </div>
                                                    <% }); %>
                                                <% } else if (typeof result.survivorPlayers === 'string') { %>
                                                    <!-- Legacy format support -->
                                                    <% result.survivorPlayers.split(',').forEach(player => { %>
                                                        <div class="survivor-info">
                                                            <span class="player-name"><%= player.trim() %></span>
                                                        </div>
                                                    <% }); %>
                                                <% } %>
                                            </div>
                                        </td>
                                        <td>
                                            <span class="result-score">
                                                <%= result.eliminatedCount %>Âêä„Çä : <%= result.escapedCount %>ÈÄÉ„Åí
                                            </span>
                                        </td>
                                        <td>
                                            <span class="points hunter-points"><%= result.hunterPoints %></span>
                                            :
                                            <span class="points survivor-points"><%= result.survivorPoints %></span>
                                        </td>
                                        <td>
                                            <%= result.createdAt?.toDate ? result.createdAt.toDate().toLocaleDateString('ja-JP') : '‰∏çÊòé' %>
                                        </td>
                                        <td>
                                            <button class="btn btn-small btn-info" onclick="viewDetails('<%= result.id %>')">Ë©≥Á¥∞</button>
                                        </td>
                                    </tr>
                                <% }); %>
                            </tbody>
                        </table>
                    </div>
                <% } %>
            </div>
        </div>

        <% if (typeof query !== 'undefined' && query.success) { %>
            <div class="success-message">
                ‚úÖ Ë©¶ÂêàÁµêÊûú„ÅåÊ≠£Â∏∏„Å´‰øùÂ≠ò„Åï„Çå„Åæ„Åó„ÅüÔºÅ
            </div>
        <% } %>
    </main>

    <style>
        .match-results-content {
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }

        .add-result-section,
        .results-list-section {
            padding: 2rem;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        #teamSelectionRow {
            background: rgba(52, 152, 219, 0.1);
            padding: 1rem;
            border-radius: 8px;
            border: 2px solid rgba(52, 152, 219, 0.3);
        }
        
        #teamSelectionRow .form-group label {
            color: #3498db;
            font-weight: bold;
        }
        
        #teamSelectionRow select {
            border-color: #3498db;
        }
        
        #teamSelectionRow select:focus {
            border-color: #2980b9;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }

        .results-table {
            overflow-x: auto;
        }

        .results-table table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }

        .results-table th,
        .results-table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        .results-table th {
            background: rgba(255, 255, 255, 0.1);
            font-weight: 600;
            color: var(--primary-color);
        }

        .result-score {
            font-weight: 600;
            color: var(--accent-color);
        }

        .points {
            display: inline-block;
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            font-weight: 700;
            font-size: 0.9rem;
        }

        .hunter-points {
            background: var(--error-color);
            color: white;
        }

        .survivor-points {
            background: var(--primary-color);
            color: white;
        }

        .bonus-badge {
            display: inline-block;
            padding: 0.2rem 0.5rem;
            background: var(--warning-color);
            color: var(--background-dark);
            font-size: 0.7rem;
            font-weight: 600;
            border-radius: 4px;
            margin-left: 0.5rem;
        }

        .no-results {
            text-align: center;
            padding: 2rem;
            color: var(--text-secondary);
        }

        .btn-small {
            padding: 0.4rem 0.8rem;
            font-size: 0.8rem;
        }

        .btn-info {
            background: var(--secondary-color);
            color: white;
        }

        .btn-info:hover {
            background: var(--secondary-dark);
        }

        .game-info {
            font-size: 0.8rem;
            color: var(--text-secondary);
            font-style: italic;
        }

        .team-info {
            font-size: 0.8rem;
            color: var(--text-secondary);
            font-style: italic;
        }

        .series-link a {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 600;
        }

        .series-link a:hover {
            text-decoration: underline;
        }

        .no-series {
            color: var(--text-secondary);
            font-style: italic;
        }

        .survivors-section {
            margin: 1.5rem 0;
            padding: 1rem;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.05);
        }

        .survivors-section h4 {
            margin: 0 0 1rem 0;
            color: var(--primary-color);
            font-size: 1.1rem;
        }

        .survivor-players {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .survivors-list {
            display: flex;
            flex-direction: column;
            gap: 0.3rem;
        }

        .survivor-info {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
        }

        .player-name {
            font-weight: 600;
        }

        .character-badge {
            background: var(--secondary-color);
            color: white;
            padding: 0.1rem 0.4rem;
            border-radius: 4px;
            font-size: 0.7rem;
            font-weight: 500;
        }

        .character-info {
            font-size: 0.8rem;
            color: var(--primary-color);
            font-style: italic;
            font-weight: 500;
        }

        .player-info {
            display: flex;
            flex-direction: column;
            gap: 0.2rem;
        }

        .survivor-row {
            display: grid;
            grid-template-columns: 2fr 3fr;
            gap: 1rem;
            align-items: end;
        }

        .survivor-name input,
        .survivor-character select {
            width: 100%;
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .survivor-row {
                grid-template-columns: 1fr;
            }
        }
    </style>

    <script>
        // Dynamic team selection functionality
        let tournamentTeams = [];
        
        // Event listener for tournament selection
        document.getElementById('tournamentId').addEventListener('change', async function() {
            const tournamentId = this.value;
            const teamSelectionRow = document.getElementById('teamSelectionRow');
            const hunterTeamSelect = document.getElementById('hunterTeamSelect');
            const survivorTeamSelect = document.getElementById('survivorTeamSelect');
            
            if (tournamentId) {
                try {
                    // Fetch teams for selected tournament
                    const response = await fetch(`/api/tournaments/${tournamentId}/teams`);
                    const result = await response.json();
                    
                    if (response.ok && result.teams) {
                        tournamentTeams = result.teams;
                        
                        // Clear and populate team dropdowns
                        hunterTeamSelect.innerHTML = '<option value="">„ÉÅ„Éº„É†„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</option>';
                        survivorTeamSelect.innerHTML = '<option value="">„ÉÅ„Éº„É†„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</option>';
                        
                        result.teams.forEach(team => {
                            const option1 = new Option(`${team.name} (${team.members.length}‰∫∫)`, team.id);
                            const option2 = new Option(`${team.name} (${team.members.length}‰∫∫)`, team.id);
                            hunterTeamSelect.add(option1);
                            survivorTeamSelect.add(option2);
                        });
                        
                        // Show team selection if teams exist
                        if (result.teams.length > 0) {
                            teamSelectionRow.style.display = 'flex';
                        } else {
                            teamSelectionRow.style.display = 'none';
                        }
                    }
                } catch (error) {
                    console.error('Error fetching teams:', error);
                    teamSelectionRow.style.display = 'none';
                }
            } else {
                teamSelectionRow.style.display = 'none';
                tournamentTeams = [];
            }
            
            // Clear player selections when tournament changes
            clearPlayerSelections();
        });
        
        // Event listener for hunter team selection
        document.getElementById('hunterTeamSelect').addEventListener('change', function() {
            const teamId = this.value;
            if (teamId) {
                populatePlayerDropdown('hunterPlayer', teamId, 'hunter');
            } else {
                clearPlayerDropdown('hunterPlayer');
            }
        });
        
        // Event listener for survivor team selection
        document.getElementById('survivorTeamSelect').addEventListener('change', function() {
            const teamId = this.value;
            if (teamId) {
                populateSurvivorDropdowns(teamId);
            } else {
                clearSurvivorDropdowns();
            }
        });
        
        // Event listener for series selection to auto-generate match title
        document.getElementById('seriesId').addEventListener('change', function() {
            const seriesId = this.value;
            const matchTitle = document.getElementById('matchTitle');
            
            if (seriesId) {
                // Auto-generate match title based on existing games in series
                generateSeriesMatchTitle(seriesId);
                matchTitle.readOnly = true;
                matchTitle.style.backgroundColor = '#f8f9fa';
            } else {
                matchTitle.readOnly = false;
                matchTitle.style.backgroundColor = '';
                matchTitle.value = '';
            }
        });
        
        async function generateSeriesMatchTitle(seriesId) {
            try {
                // Get series data to determine current game number
                const response = await fetch(`/admin/series/${seriesId}`);
                if (response.ok) {
                    // For now, we'll use a simple counter. In a real implementation,
                    // we'd parse the series data to determine the next game number
                    const gameNumber = Math.floor(Math.random() * 3) + 1; // Placeholder
                    document.getElementById('matchTitle').value = `${gameNumber}ÂõûÊà¶`;
                }
            } catch (error) {
                console.error('Error generating match title:', error);
            }
        }
        
        function populatePlayerDropdown(fieldId, teamId, role) {
            const team = tournamentTeams.find(t => t.id === teamId);
            if (!team) return;
            
            const field = document.getElementById(fieldId);
            const fieldContainer = field.parentElement;
            
            // Replace text input with dropdown
            const dropdown = document.createElement('select');
            dropdown.id = fieldId;
            dropdown.name = fieldId;
            dropdown.required = true;
            dropdown.innerHTML = '<option value="">„Éó„É¨„Ç§„É§„Éº„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</option>';
            
            team.members.forEach(member => {
                const option = new Option(
                    `${member.username} (H:${member.hunterRank}ÊÆµ S:${member.survivorRank}ÊÆµ)`,
                    member.username
                );
                dropdown.add(option);
            });
            
            fieldContainer.replaceChild(dropdown, field);
        }
        
        function populateSurvivorDropdowns(teamId) {
            const team = tournamentTeams.find(t => t.id === teamId);
            if (!team) return;
            
            for (let i = 1; i <= 4; i++) {
                const fieldId = `survivorPlayer${i}`;
                const field = document.getElementById(fieldId);
                const fieldContainer = field.parentElement;
                
                // Replace text input with dropdown
                const dropdown = document.createElement('select');
                dropdown.id = fieldId;
                dropdown.name = fieldId;
                dropdown.innerHTML = '<option value="">„Éó„É¨„Ç§„É§„Éº„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</option>';
                
                team.members.forEach(member => {
                    const option = new Option(
                        `${member.username} (H:${member.hunterRank}ÊÆµ S:${member.survivorRank}ÊÆµ)`,
                        member.username
                    );
                    dropdown.add(option);
                });
                
                fieldContainer.replaceChild(dropdown, field);
            }
        }
        
        function clearPlayerSelections() {
            // Clear hunter player
            clearPlayerDropdown('hunterPlayer');
            // Clear survivor players
            clearSurvivorDropdowns();
        }
        
        function clearPlayerDropdown(fieldId) {
            const field = document.getElementById(fieldId);
            if (field && field.tagName === 'SELECT') {
                const fieldContainer = field.parentElement;
                const textInput = document.createElement('input');
                textInput.type = 'text';
                textInput.id = fieldId;
                textInput.name = fieldId;
                textInput.required = true;
                textInput.placeholder = fieldId === 'hunterPlayer' ? '„Éè„É≥„Çø„Éº„ÅÆ„Éó„É¨„Ç§„É§„ÉºÂêç' : '„Éó„É¨„Ç§„É§„ÉºÂêç';
                
                fieldContainer.replaceChild(textInput, field);
            }
        }
        
        function clearSurvivorDropdowns() {
            for (let i = 1; i <= 4; i++) {
                const fieldId = `survivorPlayer${i}`;
                const field = document.getElementById(fieldId);
                if (field && field.tagName === 'SELECT') {
                    const fieldContainer = field.parentElement;
                    const textInput = document.createElement('input');
                    textInput.type = 'text';
                    textInput.id = fieldId;
                    textInput.name = fieldId;
                    textInput.placeholder = '„Éó„É¨„Ç§„É§„ÉºÂêç';
                    
                    fieldContainer.replaceChild(textInput, field);
                }
            }
        }
        
        function calculatePoints() {
            const eliminated = parseInt(document.getElementById('eliminatedCount').value) || 0;
            const escaped = parseInt(document.getElementById('escapedCount').value) || 0;
            
            if (eliminated + escaped !== 4) {
                alert('Âêä„ÇäÊï∞„Å®ÈÄÉ„ÅíÊï∞„ÅÆÂêàË®à„Åå4„Å´„Å™„Çã„Çà„ÅÜ„Å´„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                return;
            }
            
            let hunterPoints = eliminated;
            let survivorPoints = escaped;
            let bonusMessage = '';
            
            // Check if bonus scoring would apply (this is a client-side approximation)
            if (eliminated === 4) {
                bonusMessage = '\n\n‚ö†Ô∏è 4Âêä„Çä„ÅÆÂ†¥Âêà„ÄÅ„Éú„Éº„Éä„Çπ„Çπ„Ç≥„Ç¢„É™„É≥„Ç∞„ÅåÊúâÂäπ„Å†„Å®„Éè„É≥„Çø„Éº„Éù„Ç§„É≥„Éà„Åå5„Éù„Ç§„É≥„Éà„Å´„Å™„Çä„Åæ„Åô„ÄÇ';
            }
            
            alert(`„Éù„Ç§„É≥„ÉàË®àÁÆóÁµêÊûú:\n„Éè„É≥„Çø„Éº: ${hunterPoints}„Éù„Ç§„É≥„Éà\n„Çµ„Éê„Ç§„Éê„Éº: ${survivorPoints}„Éù„Ç§„É≥„Éà${bonusMessage}`);
        }
        
        function viewDetails(resultId) {
            // This would open a modal or navigate to a detail page
            alert('Ë©≥Á¥∞Ë°®Á§∫Ê©üËÉΩ„ÅØ‰ªäÂæåÂÆüË£Ö‰∫àÂÆö„Åß„Åô„ÄÇID: ' + resultId);
        }
        
        // Auto-calculate escaped count when eliminated count changes
        document.getElementById('eliminatedCount').addEventListener('change', function() {
            const eliminated = parseInt(this.value) || 0;
            const escaped = 4 - eliminated;
            document.getElementById('escapedCount').value = escaped;
        });
    </script>
</body>
</html>